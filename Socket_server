import socket,sys
HOST = '127.0.0.1'
PORT = 7000

try:
    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM) #creat socket
except socket.error:
    sys.stderr.write('[ERROR]') #create socket failed 
    sys.exit()

server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) #重設tcp
server.bind((HOST, PORT)) #綁定IP
server.listen(5) #監聽(最多可有()人連線)
# server.settimeout(10) #閒置時間

print('Server start at: %s:%s' %(HOST, PORT))
print('wait for connection...')

while True: #持續接收
    (client, addr) = server.accept() #接收client訊息
    print('Client by ', addr)
    data = client.recv(1024) #接收字元

    if not data:
        pass
    else:
        print('Client send:' + data.decode("utf-8"))

        try:
            info = input('Please input your info')
            server.send(info.encode('utf-8'))
        except socket.error:
            print('Send failed')
            sys.exit()
        print('Send successfully')  

client.close()
server.close()
